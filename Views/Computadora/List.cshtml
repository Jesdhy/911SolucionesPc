@model List<PcSoluciones.Models.ViewModel.ComputadoraVista.UsuarioConComputadoraModel>
@{
    ViewBag.Title = "Listado Usuarios y Computadoras";
}

<h2 class="text-center">@ViewBag.Title</h2>

<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">

<style>
    body {
        background-image: url('/pictures/fondoFr.png');
        background-size: cover;
        background-attachment: fixed;
        margin: 0;
        padding: 0;
    }
</style>


<div class="container mt-3">
    <div class="btn-group">
        <button type="button" class="btn btn-outline-primary" onclick="getListComputadora()">
            <i class="fas fa-sync"></i> Refrescar
        </button>
        <button type="button" class="btn btn-outline-primary" onclick="document.location.href='@Url.Content("~/Computadora/New")'">
            <i class="fas fa-plus"></i> Nuevo
        </button>
    </div>

    <div class="table-responsive mt-3">
        <table class="table table-striped">
            <thead class="thead-dark">
                <tr>
                    <th>Usuario</th>
                    <th>Modelo</th>
                    <th>Descripción</th>
                    <th>Acción</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var usuarioConComputadora in Model)
                {
                    foreach (var computadora in usuarioConComputadora.Computadoras)
                    {
                        <tr>
                            <td>@usuarioConComputadora.usuario.nombre</td>
                            <td>@computadora.modelo</td>
                            <td>@computadora.descripcion</td>
                            <td>
                                <a href="@Url.Action("Edit", "Computadora", new { id_computadora = computadora.id_computadora })" class="btn btn-primary btn-sm">
                                    <i class="fas fa-pencil-alt"></i> Editar
                                </a>
                                <button type="button" class="btn btn-danger btn-sm" onclick="eliminarComputadora('@computadora.id_computadora')">
                                    <i class="fas fa-trash-alt"></i> Eliminar
                                </button>
                            </td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>
</div>

@section scripts {
    <script>
        function eliminarComputadora(id_computadora) {
            if (confirm('¿Estás seguro de que deseas eliminar esta computadora?')) {
                $.ajax({
                    url: '@Url.Action("Delete", "Computadora")',
                    type: 'POST',
                    data: { id_computadora: id_computadora },
                    success: function (response) {
                        if (response === "1") {
                            alert("Computadora eliminada correctamente");
                            window.location.reload();
                        } else {
                            alert("Error al eliminar la computadora");
                        }
                    },
                    error: function () {
                        alert("Error al eliminar la computadora");
                    }
                });
            }
        }
    </script>
}






